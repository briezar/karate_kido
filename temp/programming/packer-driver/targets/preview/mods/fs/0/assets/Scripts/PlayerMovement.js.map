{"version":3,"sources":["file:///D:/Cocos/Projects/TreeChopper/assets/Scripts/PlayerMovement.ts"],"names":["_decorator","Component","systemEvent","SystemEventType","KeyCode","resources","SpriteFrame","Sprite","RigidBody2D","Vec2","randomRange","sys","GameController","SoundManager","TreeManager","ccclass","property","PlayerMovement","type","onLoad","on","KEY_DOWN","onKeyDown","sprite","getComponent","rigidBody2D","distanceFromTree","Math","abs","node","position","x","treeManager","playerMovement","parseInt","localStorage","getItem","axeLevel","load","spriteDirectory","err","spriteFrame","spriteArray","push","event","Instance","isLost","isPaused","keyCode","ARROW_LEFT","KEY_A","chopLeft","ARROW_RIGHT","KEY_D","chopRight","setScale","setPosition","y","chopTree","playChopAnimation","knockDown","scheduleOnce","linearVelocity","playSound","bonkSound","knockAway","punchSound","angularVelocity","scale","unschedule","stopChopAnimation"],"mappings":"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","sourcesContent":["\nimport { _decorator, Component, Node, systemEvent, SystemEventType, EventKeyboard, KeyCode, Vec3, resources, Asset, SpriteFrame, Sprite, Scheduler, RigidBody2D, Vec2, UITransform, random, randomRange, ERigidBody2DType, sys } from 'cc';\nimport { GameController } from './GameController';\r\nimport { SoundManager } from './SoundManager';\r\nimport { TreeManager } from './TreeManager';\r\nconst { ccclass, property } = _decorator;\n\n/**\n * Predefined variables\n * Name = PlayerMovement\n * DateTime = Thu Feb 10 2022 22:37:08 GMT+0700 (Indochina Time)\n * Author = briezar\n * FileBasename = PlayerMovement.ts\n * FileBasenameNoExtension = PlayerMovement\n * URL = db://assets/PlayerMovement.ts\n * ManualUrl = https://docs.cocos.com/creator/3.4/manual/en/\n *\n */\n\n@ccclass('PlayerMovement')\nexport class PlayerMovement extends Component {\n    @property({ type: TreeManager })\n    public treeManager: TreeManager;\n\n    distanceFromTree: number;\n    axeLevel: number = 0;\n    spriteDirectory: string[][] =\n        [\n            [\"lumberjackSilver_0/spriteFrame\", \"lumberjackSilver_1/spriteFrame\"],\n            [\"lumberjackGold_0/spriteFrame\", \"lumberjackGold_1/spriteFrame\"]\n        ];\n\n    //Player is on the left when scale.x = -1;\n    spriteArray: SpriteFrame[] = [];\n    sprite: Sprite;\n    rigidBody2D: RigidBody2D;\n\n    onLoad() {\n        systemEvent.on(SystemEventType.KEY_DOWN, this.onKeyDown, this);\n        this.sprite = this.getComponent(Sprite);\n        this.rigidBody2D = this.getComponent(RigidBody2D);\n\n        this.distanceFromTree = Math.abs(this.node.position.x);\n        this.treeManager.playerMovement = this;\n        if (parseInt(sys.localStorage.getItem('bestScore')) > 1000) {\r\n            this.axeLevel++;\r\n        }\n\n        resources.load(this.spriteDirectory[this.axeLevel][0], SpriteFrame, (err, spriteFrame) => {\r\n            this.spriteArray.push(spriteFrame);\r\n            this.sprite.spriteFrame = spriteFrame;\r\n\r\n        });\n\n        resources.load(this.spriteDirectory[this.axeLevel][1], SpriteFrame, (err, spriteFrame) => {\r\n            this.spriteArray.push(spriteFrame);\r\n        });\r\n    }\n\n    onKeyDown(event: EventKeyboard) {\n        if (GameController.Instance.isLost || GameController.Instance.isPaused) return;\r\n\n        switch (event.keyCode) {\n            case KeyCode.ARROW_LEFT:\n            case KeyCode.KEY_A:\n                this.chopLeft();\n                break;\n            case KeyCode.ARROW_RIGHT:\n            case KeyCode.KEY_D:\n                this.chopRight();\n                break;\n        }\n    }\r\n\r\n    chopRight() {\r\n        this.node.setScale(1, 1, 1);\r\n        this.node.setPosition(this.distanceFromTree, this.node.position.y, 0);\r\n        this.treeManager.chopTree();\r\n        this.playChopAnimation();\r\n    }\r\n\r\n    chopLeft() {\r\n        this.node.setScale(-1, 1, 1);\n        this.node.setPosition(-this.distanceFromTree, this.node.position.y, 0);\n        this.treeManager.chopTree();\r\n        this.playChopAnimation();\r\n    }\r\n\r\n\r\n    knockDown() {\r\n        this.scheduleOnce(() => {\r\n            this.rigidBody2D.linearVelocity = new Vec2(0, -20);\r\n            SoundManager.Instance.playSound(SoundManager.Instance.bonkSound);\r\n        }, 0.1);\r\n    }\r\n\r\n    knockAway() {\r\n        SoundManager.Instance.playSound(SoundManager.Instance.punchSound);\r\n        this.rigidBody2D.angularVelocity = this.node.scale.x * 60;\r\n        this.rigidBody2D.linearVelocity = new Vec2(this.node.scale.x * 40, randomRange(15, 20));\r\n\r\n    }\r\n\r\n    playChopAnimation() {\r\n        this.unschedule(this.stopChopAnimation);\r\n        this.sprite.spriteFrame = this.spriteArray[0];\r\n        this.scheduleOnce(() => {\r\n            this.sprite.spriteFrame = this.spriteArray[1];\r\n        }, 0.05);\r\n\r\n        this.scheduleOnce(this.stopChopAnimation, 0.2);\r\n    }\r\n\r\n    stopChopAnimation() {\r\n        this.sprite.spriteFrame = this.spriteArray[0];\r\n    }\r\n\n    //update (deltaTime: number) {\n\n    //}\n}\n\n/**\n * [1] Class member could be defined like this.\n * [2] Use `property` decorator if your want the member to be serializable.\n * [3] Your initialization goes here.\n * [4] Your update function goes here.\n *\n * Learn more about scripting: https://docs.cocos.com/creator/3.4/manual/en/scripting/\n * Learn more about CCClass: https://docs.cocos.com/creator/3.4/manual/en/scripting/ccclass.html\n * Learn more about life-cycle callbacks: https://docs.cocos.com/creator/3.4/manual/en/scripting/life-cycle-callbacks.html\n */\n"]}